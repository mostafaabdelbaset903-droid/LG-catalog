<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Built-in & Ù…ÙŠÙƒØ±ÙˆÙˆÙŠÙ</title>
<link rel="stylesheet" href="soft-ui.css">
</head>
<body>

<header>
<div class="wrap">
<div class="topbar">
<div>
<div class="title">Built-in & Ù…ÙŠÙƒØ±ÙˆÙˆÙŠÙ</div>
<div class="subtitle">Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„Ø§Øª â†’ Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø© â†’ Ø£Ø±Ø³Ù„ ÙˆØ§ØªØ³Ø§Ø¨</div>

<div class="nav">
<a href="index.html">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
<a href="ac.html">ØªÙƒÙŠÙŠÙØ§Øª</a>
<a href="washers.html">ØºØ³Ø§Ù„Ø§Øª</a>
<a href="fridges.html">Ø«Ù„Ø§Ø¬Ø§Øª</a>
<a class="active" href="builtin.html">Built-in</a>
<a href="view.html">Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ù…ÙŠÙ„</a>
</div>
</div>

<button class="btn btnGhost" id="btnClear">Ù…Ø³Ø­ Ø§Ù„Ø³Ù„Ø©</button>
</div>
</div>
</header>

<div class="wrap layout">
<main id="content"></main>

<aside class="cartBar">
<div class="cartHeader">
<div>
<div class="cartTitle">Ø§Ù„Ø³Ù„Ø©</div>
<div class="small" id="cartCount">0 Ù…ÙˆØ¯ÙŠÙ„</div>
</div>
<button class="btn btnGhost" id="btnToggle">Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡</button>
</div>

<div id="cartBody">

<div class="cartItems" id="cartItems">
<div class="small">Ù„Ø³Ù‡ Ù…ÙÙŠØ´ Ø§Ø®ØªÙŠØ§Ø±Ø§Øª.</div>
</div>

<div class="row">
<div style="width:100%">
<div class="small" style="margin:8px 0 6px;">Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨ Ø§Ù„Ø¹Ù…ÙŠÙ„</div>
<input id="phone" placeholder="2010xxxxxxx"/>
</div>
</div>

<div class="row">
<div style="width:100%">
<div class="small" style="margin:8px 0 6px;">Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù</div>
<input id="employee" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ"/>
</div>
</div>

<div class="row">
<button class="btn btnGhost" id="btnLink">Ø¥Ù†Ø´Ø§Ø¡ Ù„ÙŠÙ†Ùƒ</button>
<button class="btn btnPrimary" id="btnWhats">Ø¥Ø±Ø³Ø§Ù„ ÙˆØ§ØªØ³Ø§Ø¨</button>
</div>

<div class="small" style="margin-top:10px;">
Ù„ÙŠÙ†Ùƒ Ø§Ù„Ø¹Ù…ÙŠÙ„:
<span id="linkOut">â€”</span>
</div>

</div>
</aside>
</div>

<div class="wrap spacer"></div>

<script src="products.js"></script>

<script>

/* ğŸ”¥ Ù„ÙŠÙ†Ùƒ Google Script */
const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwgSdcyBHLtT-8VNJGEm1EP8lej3iZBFNN58d8qatSlEaPgOKCr2xBPeA2X6oB9-Iez/exec";

const CART_KEY = "lg_cart_v1";

function loadCart(){
return JSON.parse(localStorage.getItem(CART_KEY) || "[]");
}

function saveCart(data){
localStorage.setItem(CART_KEY, JSON.stringify(data));
}

const ALL = window.PRODUCTS || [];
const contentEl = document.getElementById("content");
const cartItemsEl = document.getElementById("cartItems");
const cartCountEl = document.getElementById("cartCount");
const linkOutEl = document.getElementById("linkOut");
const phoneInput = document.getElementById("phone");
const employeeInput = document.getElementById("employee");

let cart = loadCart();
let cartVisible = true;

/* Ø¹Ø±Ø¶ Built-in */
function renderProducts(){

contentEl.innerHTML = "";
const items = ALL.filter(p => p.section === "builtin");

if(items.length === 0){
contentEl.innerHTML = "<div class='small'>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Built-in</div>";
return;
}

const grid = document.createElement("div");
grid.className = "grid";

items.forEach(p=>{
const card = document.createElement("div");
card.className="card";

card.innerHTML=`
<div class="cardMedia">
<img src="${p.img || ""}" alt="">
</div>
<div class="p">
<div class="name">${p.name || p.model || "â€”"}</div>
<ul>
${(p.features||[]).slice(0,6).map(f=>`<li>${f}</li>`).join("")}
</ul>
${p.dims ? `
<div class="dimsBox">
<div>${p.dims.w} Ã— ${p.dims.d} Ã— ${p.dims.h}</div>
</div>
` : ""}
<button class="btn btnAdd">Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø©</button>
</div>
`;

card.querySelector(".btnAdd").onclick=()=>addToCart(p.id);
grid.appendChild(card);
});

contentEl.appendChild(grid);
}

/* Ø§Ù„Ø³Ù„Ø© */
function addToCart(id){
if(!cart.includes(id)){
cart.push(id);
saveCart(cart);
renderCart();
}
}

function removeFromCart(id){
cart = cart.filter(x=>x!==id);
saveCart(cart);
renderCart();
}
window.removeFromCart = removeFromCart;

function renderCart(){

const items = cart.map(id=>ALL.find(p=>p.id===id)).filter(Boolean);
cartCountEl.textContent = items.length + " Ù…ÙˆØ¯ÙŠÙ„";

if(items.length===0){
cartItemsEl.innerHTML="<div class='small'>Ù„Ø³Ù‡ Ù…ÙÙŠØ´ Ø§Ø®ØªÙŠØ§Ø±Ø§Øª.</div>";
return;
}

cartItemsEl.innerHTML = items.map(p=>`
<div class="cartItem">
<div>${p.name || p.model || p.id}</div>
<button class="btn btnGhost"
onclick="removeFromCart('${p.id}')">Ø­Ø°Ù</button>
</div>
`).join("");
}

/* Ø¥Ù†Ø´Ø§Ø¡ Ù„ÙŠÙ†Ùƒ Ø«Ø§Ø¨Øª */
function buildLink(){

const items = cart.map(id=>ALL.find(p=>p.id===id)).filter(Boolean);
if(items.length===0) return "";

const encoded = encodeURIComponent(
btoa(unescape(encodeURIComponent(JSON.stringify(items))))
);

const base = location.origin + location.pathname.replace("builtin.html","");
return base + "view.html?c=" + encoded;
}

document.getElementById("btnLink").onclick=()=>{
const link = buildLink();
linkOutEl.innerHTML = link ? `<a href="${link}" target="_blank">ÙØªØ­</a>` : "â€”";
};

document.getElementById("btnWhats").onclick=()=>{

const phone = phoneInput.value.trim();
const employee = employeeInput.value.trim();

if(!phone) return alert("Ø§ÙƒØªØ¨ Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„");
if(!employee) return alert("Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù");

const link = buildLink();
if(!link) return alert("Ø§Ù„Ø³Ù„Ø© ÙØ§Ø¶ÙŠØ©");

const items = cart.map(id=>ALL.find(p=>p.id===id)).filter(Boolean);
const list = items.map((p,i)=>`${i+1}) ${p.name || p.model || p.id}`).join("\n");

const msg = `
Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ø­Ø¶Ø±ØªÙƒ ğŸŒŸ
Ø¯ÙŠ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„Ø§Øª Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©:
${list}

ØªÙØ§ØµÙŠÙ„ ÙƒØ§Ù…Ù„Ø©:
${link}

ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨ÙˆØ§Ø³Ø·Ø©: ${employee}
`.trim();

window.open(`https://wa.me/${phone}?text=${encodeURIComponent(msg)}`,"_blank");

/* ØªØ³Ø¬ÙŠÙ„ ÙÙŠ Google Sheet */
fetch(GOOGLE_SCRIPT_URL,{
method:"POST",
body:JSON.stringify({
employee:employee,
clientPhone:phone,
products:list,
link:link,
date:new Date().toLocaleString()
})
});

};

document.getElementById("btnClear").onclick=()=>{
cart=[];
saveCart(cart);
renderCart();
};

document.getElementById("btnToggle").onclick=()=>{
cartVisible=!cartVisible;
document.getElementById("cartBody").style.display=
cartVisible?"block":"none";
};

window.addEventListener("storage",()=>{
cart=loadCart();
renderCart();
});

renderProducts();
renderCart();

</script>

</body>
</html>
